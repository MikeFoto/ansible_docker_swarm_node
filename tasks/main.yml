- name: Get Token from manager
  shell:
    docker swarm join-token {{ swarm_role }} |
    grep token  |
    sed -e "s/    --token //"  -e "s/\\\\$//g"
  register:     swarm_token
  delegate_to:  "{{ swarm_manager_inventory_name }}"
  changed_when: False

#
# TODO: NO hardcoded port
- name: Join Swarm
  shell:
    docker swarm join
      --token {{ swarm_token.stdout }}
      {{ swarm_manager_ip }}:2377
  register:      swarm_result
  changed_when:  False
  ignore_errors: True
